<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <title>Scanner CAEd Pro - Raquel</title>
    <script async src="https://docs.opencv.org/4.5.0/opencv.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.1.3/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.1.3/firebase-database-compat.js"></script>
    <style>
        body { font-family: 'Segoe UI', sans-serif; background: #f0f2f5; padding: 20px; }
        .painel { background: white; border-radius: 12px; padding: 20px; max-width: 800px; margin: auto; box-shadow: 0 4px 15px rgba(0,0,0,0.1); }
        .habilidade-alerta { color: #d9534f; font-weight: bold; }
        .acerto { color: #28a745; }
    </style>
</head>
<body>

<div class="painel">
    <h2>ðŸ“Š Analisador de Desempenho CAEd</h2>
    <input type="file" id="uploadGabarito" accept="image/*">
    <button onclick="processarGabarito()">Escanear e Salvar no Firebase</button>
    <hr>
    <div id="status">Aguardando imagem...</div>
    <div id="resultado"></div>
</div>

<script>
    // ConexÃ£o com seu Firebase
    const firebaseConfig = { databaseURL: "https://gestao-caed-default-rtdb.europe-west1.firebasedatabase.app" };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    // Matriz de ReferÃªncia 8Âº Ano
    const matrizHabilidades = {
        1: "D041_CN", 2: "D041_CN", 3: "D042_CN", 4: "D025_CN",
        5: "D095_CN", 6: "D041_CN", 7: "D041_CN", 8: "D041_CN",
        9: "D041_CN", 10: "D041_CN"
    };

    const gabaritoOficial = { 1:"D", 2:"B", 3:"A", 4:"D", 5:"A", 6:"B", 7:"D", 8:"D", 9:"A", 10:"D" };

    async function processarGabarito() {
        const status = document.getElementById('status');
        status.innerText = "Analisando marcaÃ§Ãµes nas bolinhas...";

        // LÃ³gica de Processamento de Imagem (Simulada para o modelo enviado)
        // O sistema identifica os cÃ­rculos preenchidos em cada linha
        
        let desempenhoTurma = {
            aluno: "Raquel Teste 01",
            data: 20260218,
            acertos: 0,
            errosHabilidades: []
        };

        // Loop de correÃ§Ã£o cruzando com a matriz
        for (let q = 1; q <= 10; q++) {
            // Aqui o OpenCV leria a imagem. Vamos simular um erro na Q3 para teste.
            let respostaAluno = (q === 3) ? "B" : gabaritoOficial[q]; 
            
            if(respostaAluno === gabaritoOficial[q]) {
                desempenhoTurma.acertos++;
            } else {
                desempenhoTurma.errosHabilidades.push(matrizHabilidades[q]);
            }
        }

        // Salva no seu Firebase sincronizado
        db.ref('testes/ciencias_8ano').push(desempenhoTurma);

        exibirResultado(desempenhoTurma);
    }

    function exibirResultado(dados) {
        const div = document.getElementById('resultado');
        div.innerHTML = `
            <h3>Resultado do Aluno: ${dados.aluno}</h3>
            <p class="acerto">Total de Acertos: ${dados.acertos}/10</p>
            <p class="habilidade-alerta">Habilidades para ReforÃ§o: ${[...new Set(dados.errosHabilidades)].join(', ')}</p>
            <small>Sincronizado com Firebase em: 2026-02-18</small>
        `;
    }
</script>
</body>
</html>
