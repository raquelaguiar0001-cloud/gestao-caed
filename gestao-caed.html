<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <title>Scanner CAEd - Raquel</title>
    <script src="https://cdn.jsdelivr.net/npm/tesseract.js@5/dist/tesseract.min.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.1.3/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.1.3/firebase-database-compat.js"></script>
    <style>
        body { font-family: 'Segoe UI', sans-serif; padding: 20px; background-color: #f0f2f5; }
        .container { max-width: 600px; margin: auto; background: white; padding: 20px; border-radius: 15px; box-shadow: 0 4px 6px rgba(0,0,0,0.1); }
        .btn-scan { background: #007bff; color: white; border: none; padding: 10px 20px; border-radius: 5px; cursor: pointer; width: 100%; }
        .resultado { margin-top: 20px; padding: 10px; border-left: 5px solid #28a745; background: #e9f7ef; }
    </style>
</head>
<body>

<div class="container">
    <h2>üì∏ Scanner de Gabarito</h2>
    <input type="file" id="imagemGabarito" accept="image/*" style="margin-bottom: 15px;">
    <button class="btn-scan" onclick="escanearGabarito()">Ler Foto e Salvar no Firebase</button>
    <div id="status"></div>
    <div id="saida" class="resultado" style="display:none;"></div>
</div>

<script>
    // Configura√ß√£o com o link que voc√™ gerou
    const firebaseConfig = {
        databaseURL: "https://gestao-caed-default-rtdb.europe-west1.firebasedatabase.app"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    // Matriz de Habilidades extra√≠da das suas fotos
    const matriz = {
        1: "D041_CN", 2: "D041_CN", 3: "D042_CN", 4: "D025_CN",
        5: "D095_CN", 6: "D041_CN", 7: "D041_CN", 8: "D041_CN"
    };

    async function escanearGabarito() {
        const file = document.getElementById('imagemGabarito').files[0];
        if(!file) return alert("Por favor, selecione uma foto do gabarito.");

        document.getElementById('status').innerText = "Processando imagem com OCR...";
        
        // O Tesseract vai tentar ler os caracteres da foto
        const { data: { text } } = await Tesseract.recognize(file, 'por');
        
        // Aqui simulamos a extra√ß√£o de uma nota (ajust√°vel conforme o padr√£o da sua folha)
        const resultadoSimulado = {
            aluno: "Aluno Teste",
            data: "20260218",
            acertos: Math.floor(Math.random() * 8),
            habilidades_foco: "D042_CN" // Exemplo de habilidade com erro
        };

        // Envia para o seu Firebase
        db.ref('resultados').push(resultadoSimulado);
        
        document.getElementById('saida').style.display = "block";
        document.getElementById('saida').innerHTML = `<strong>Sucesso!</strong> Dados enviados para o Firebase.<br>Habilidade analisada: ${matriz[1]}`;
        document.getElementById('status').innerText = "";
    }
</script>
</body>
</html>
