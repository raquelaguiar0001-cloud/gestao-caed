<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <title>Scanner CAEd | Raquel Aguiar</title>
    <link rel="icon" href="https://fav.farm/ðŸ“Š" />
    
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.1.3/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.1.3/firebase-database-compat.js"></script>

    <style>
        body { font-family: 'Segoe UI', sans-serif; background: #f0f2f5; padding: 20px; text-align: center; }
        .card { background: white; border-radius: 15px; padding: 25px; max-width: 600px; margin: 20px auto; box-shadow: 0 4px 10px rgba(0,0,0,0.1); }
        .btn { background: #007bff; color: white; border: none; padding: 12px 20px; border-radius: 8px; cursor: pointer; font-size: 16px; transition: 0.3s; }
        .btn:hover { background: #0056b3; }
        #graficoArea { margin-top: 30px; }
    </style>
</head>
<body>

<div class="card">
    <h1>ðŸ“Š Gestor de Habilidades CAEd</h1>
    <p>Status do Banco: <strong id="db-status">Conectando...</strong></p>
    
    <div style="margin: 20px 0;">
        <input type="text" id="nomeAluno" placeholder="Nome do Aluno" style="padding: 10px; border-radius: 5px; border: 1px solid #ccc; width: 80%;">
    </div>
    
    <button class="btn" onclick="lancarNota()">LanÃ§ar Resultado (Simular Scan)</button>
</div>

<div class="card" id="graficoArea">
    <h3>Desempenho da Turma por Habilidade</h3>
    <canvas id="meuGrafico"></canvas>
</div>

<script>
    // ConfiguraÃ§Ã£o oficial do seu Firebase na Europa
    const firebaseConfig = {
        databaseURL: "https://gestao-caed-default-rtdb.europe-west1.firebasedatabase.app"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    // Mapeamento das Habilidades (Matriz 8Âº Ano)
    const habilidades = {
        "D041_CN": "GeraÃ§Ã£o de Energia", // QuestÃµes 1, 2, 6, 8, 9, 10, 11
        "D042_CN": "ReproduÃ§Ã£o/Contraceptivos", // QuestÃµes 3, 12
        "D025_CN": "Estrutura da Terra", // QuestÃ£o 4
        "D095_CN": "Impactos Ambientais" // QuestÃ£o 5
    };

    // Verifica conexÃ£o
    db.ref('.info/connected').on('value', (snap) => {
        document.getElementById('db-status').innerText = snap.val() ? "Conectado âœ…" : "Erro de ConexÃ£o âŒ";
    });

    function lancarNota() {
        const nome = document.getElementById('nomeAluno').value;
        if(!nome) return alert("Digite o nome do aluno!");

        // Simula o scan identificando erros nas habilidades crÃ­ticas
        const erroSorteado = Object.keys(habilidades)[Math.floor(Math.random() * 4)];

        db.ref('avaliacoes').push({
            aluno: nome,
            habilidade_defasada: erroSorteado,
            data: "2026-02-18"
        }).then(() => alert("Resultado de " + nome + " salvo!"));
    }

    // GrÃ¡fico em tempo real
    db.ref('avaliacoes').on('value', (snapshot) => {
        const dados = snapshot.val();
        if(!dados) return;

        let contagem = { "D041_CN": 0, "D042_CN": 0, "D025_CN": 0, "D095_CN": 0 };
        Object.values(dados).forEach(item => {
            contagem[item.habilidade_defasada]++;
        });

        desenharGrafico(contagem);
    });

    let chartInstance = null;
    function desenharGrafico(contagem) {
        const ctx = document.getElementById('meuGrafico').getContext('2d');
        if(chartInstance) chartInstance.destroy();
        
        chartInstance = new Chart(ctx, {
            type: 'bar',
            data: {
                labels: Object.keys(contagem),
                datasets: [{
                    label: 'NÃºmero de Alunos com Dificuldade',
                    data: Object.values(contagem),
                    backgroundColor: '#ff6384'
                }]
            }
        });
    }
</script>
</body>
</html>
